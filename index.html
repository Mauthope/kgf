<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Testador de Hipóteses</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input, button { margin: 5px; padding: 8px; }
    table { width: 100%; margin-top: 20px; border-collapse: collapse; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f4f4f4; }
    .popup { display: none; position: fixed; top: 20%; left: 30%; background: white; border: 1px solid #000; padding: 20px; z-index: 1000; }
    .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999; }
  </style>
</head>
<body>

<h2>Testador de Hipóteses</h2>

<form id="formulario">
  <label>Distância (cm): <input type="number" step="0.01" id="distancia" required></label><br>
  <label>Temperatura (°C): <input type="number" step="0.01" id="temperatura" required></label><br>
  <label>Vazão: <input type="number" step="0.01" id="vazao" required></label><br>
  <button type="button" onclick="abrirPopup('interno')">Inserir KgF Interno</button>
  <button type="button" onclick="abrirPopup('externo')">Inserir KgF Externo</button>
  <button type="button" onclick="abrirPopup('queda')">Inserir Valores de Queda</button><br>
  <button type="submit">Salvar Dados</button>
</form>

<h3>Resultados</h3>
<table>
  <thead>
    <tr>
      <th>Distância</th><th>Temperatura</th><th>Vazão</th>
      <th>KgF Interno</th><th>KgF Externo</th><th>Queda</th>
    </tr>
  </thead>
  <tbody id="resultado"></tbody>
</table>

<div class="overlay" id="overlay"></div>
<div class="popup" id="popup">
  <h4 id="popup-titulo"></h4>
  <div id="popup-inputs"></div>
  <button onclick="fecharPopup(true)">Confirmar</button>
  <button onclick="fecharPopup(false)">Cancelar</button>
</div>

<script>
  let dados = JSON.parse(localStorage.getItem('amostras')) || [];
  let tipoAtual = '', valoresTemp = [];

  function renderizarTabela() {
    const tbody = document.getElementById('resultado');
    tbody.innerHTML = '';
    dados.forEach(item => {
      tbody.innerHTML += `
        <tr>
          <td>${item.distancia}</td>
          <td>${item.temperatura}</td>
          <td>${item.vazao}</td>
          <td>${item.kgfInterno}</td>
          <td>${item.kgfExterno}</td>
          <td style="color:${item.quedaStatus === 'Reprovado' ? 'red' : 'green'}">${item.quedaStatus}</td>
        </tr>
      `;
    });
  }

  function abrirPopup(tipo) {
    tipoAtual = tipo;
    valoresTemp = [];
    const inputsDiv = document.getElementById('popup-inputs');
    inputsDiv.innerHTML = '';
    document.getElementById('popup-titulo').innerText = 
      tipo === 'queda' ? 'Inserir 5 valores da Queda' : `Inserir 5 valores de KgF ${tipo === 'interno' ? 'Interno' : 'Externo'}`;
    for (let i = 0; i < 5; i++) {
      inputsDiv.innerHTML += `<input type="number" step="0.01" id="valor${i}" required><br>`;
    }
    document.getElementById('overlay').style.display = 'block';
    document.getElementById('popup').style.display = 'block';
  }

  function fecharPopup(confirmar) {
    if (confirmar) {
      for (let i = 0; i < 5; i++) {
        valoresTemp.push(parseFloat(document.getElementById('valor'+i).value));
      }
      if (tipoAtual === 'queda') {
        let reprovado = valoresTemp.some(v => v < 5); // exemplo: valor mínimo 5
        sessionStorage.setItem('quedaStatus', reprovado ? 'Reprovado' : 'Aprovado');
      } else {
        let media = valoresTemp.reduce((a,b) => a + b, 0) / valoresTemp.length;
        sessionStorage.setItem(`kgf${tipoAtual.charAt(0).toUpperCase() + tipoAtual.slice(1)}`, media.toFixed(2));
      }
    }
    document.getElementById('overlay').style.display = 'none';
    document.getElementById('popup').style.display = 'none';
  }

  document.getElementById('formulario').addEventListener('submit', function(e) {
    e.preventDefault();
    const distancia = parseFloat(document.getElementById('distancia').value);
    const temperatura = parseFloat(document.getElementById('temperatura').value);
    const vazao = parseFloat(document.getElementById('vazao').value);
    const kgfInterno = sessionStorage.getItem('kgfInterno') || '0';
    const kgfExterno = sessionStorage.getItem('kgfExterno') || '0';
    const quedaStatus = sessionStorage.getItem('quedaStatus') || 'Reprovado';

    dados.push({ distancia, temperatura, vazao, kgfInterno, kgfExterno, quedaStatus });
    localStorage.setItem('amostras', JSON.stringify(dados));
    renderizarTabela();
    this.reset();
  });

  renderizarTabela();
</script>

</body>
</html>
